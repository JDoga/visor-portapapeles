<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Visor JPDB palabra por palabra</title>
<style>
  body {
    background: #121212;
    color: #fff;
    font-family: Arial, sans-serif;
    padding: 1em;
  }
  #textContainer {
    font-size: 16px;
    user-select: text;
  }
  .word-link {
    color: #fff;
    text-decoration: none;
    cursor: pointer;
    margin-right: 3px;
  }
  .word-link:hover {
    text-decoration: underline;
  }
  .line {
    margin-bottom: 1em;
  }
</style>
</head>
<body>

<h2>Texto parseado y enlazado palabra por palabra a JPDB</h2>
<div id="textContainer"></div>

<script>
const STORAGE_KEY = "textoGuardado";

async function parseJPDB(sentence) {
  try {
    const response = await fetch(`https://jpdb.io/api/v1/parse?sentence=${encodeURIComponent(sentence)}`);
    if (!response.ok) throw new Error('Error al llamar a la API JPDB');
    const data = await response.json();
    return data.result; // Array de palabras segmentadas
  } catch (e) {
    console.error(e);
    return null;
  }
}

async function renderTexto() {
  const container = document.getElementById('textContainer');
  container.innerHTML = '';

  let texto = localStorage.getItem(STORAGE_KEY) || '';

  if (!texto.trim()) {
    container.textContent = 'No hay texto guardado';
    return;
  }

  const lineas = texto.split('\n').filter(line => line.trim() !== '');

  for (let linea of lineas) {
    const divLinea = document.createElement('div');
    divLinea.className = 'line';

    const palabras = await parseJPDB(linea);

    if (!palabras) {
      divLinea.textContent = linea; // Mostrar línea sin parsear si falla API
      container.appendChild(divLinea);
      continue;
    }

    for (let palabraObj of palabras) {
      const word = palabraObj.word;
      const a = document.createElement('a');
      a.className = 'word-link';
      a.href = `https://jpdb.io/search?q=${encodeURIComponent(word)}`;
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.textContent = word;
      divLinea.appendChild(a);
    }

    container.appendChild(divLinea);
  }
}

// Cargar y mostrar texto al abrir página
renderTexto();
</script>

</body>
</html>
